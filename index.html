<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PrecificApp Dashboard Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-grafite: #1c1c1c;
            --card-gray: #2a2a2a;
            --orange: #ff6600;
            --text-white: #ffffff;
            --green: #22c55e;
            --red: #ef4444;
            --border: #3d3d3d;
        }

        body { font-family: 'Inter', sans-serif; background-color: var(--bg-grafite); color: var(--text-white); margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        h1, h2, h3 { color: var(--orange); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 15px; font-size: 1rem; }
        
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--orange); padding-bottom: 10px; margin-bottom: 30px; }

        .grid-main { display: grid; grid-template-columns: 1.2fr 1fr; gap: 20px; }
        @media (max-width: 850px) { .grid-main { grid-template-columns: 1fr; } }

        .card { background: var(--card-gray); padding: 20px; border-radius: 12px; border: 1px solid var(--border); margin-bottom: 20px; }

        .input-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        label { display: block; font-size: 0.7rem; color: #bbbbbb; margin-bottom: 6px; font-weight: 700; text-transform: uppercase; }
        
        input, select {
            width: 100%; background: #121212; border: 1px solid var(--border);
            padding: 12px; border-radius: 8px; color: #fff; outline: none; font-size: 15px; box-sizing: border-box;
        }
        input:focus { border-color: var(--orange); }

        .result-box { background: #121212; padding: 25px; border-radius: 15px; border: 2px solid var(--orange); text-align: center; }
        .big-price { font-size: 3rem; font-weight: bold; margin: 5px 0; }

        .detail-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border); font-size: 0.85rem; }
        
        /* Barra de Composição */
        .comp-bar { display: flex; height: 10px; border-radius: 5px; overflow: hidden; margin: 15px 0; background: #444; }
        .comp-item { height: 100%; transition: width 0.3s; }

        .projection-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin-top: 20px; }
        .proj-card { background: var(--card-gray); padding: 12px; border-radius: 10px; text-align: center; border: 1px solid var(--border); font-size: 0.8rem; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1 style="margin:0;">PrecificApp Dashboard</h1>
        <select id="moeda" style="width: 100px;" onchange="calcular()">
            <option value="R$">BRL (R$)</option>
            <option value="$">USD ($)</option>
            <option value="€">EUR (€)</option>
            <option value="£">GBP (£)</option>
        </select>
    </div>

    <div class="grid-main">
        <div>
            <div class="card">
                <h3>1. Valores de Base</h3>
                <div class="input-row">
                    <div><label>Custo do Produto</label><input type="number" id="custoProd" oninput="calcular()"></div>
                    <div><label>Frete (Envio)</label><input type="number" id="frete" oninput="calcular()"></div>
                </div>
                <label>Preço de Venda Final</label>
                <input type="number" id="precoVenda" oninput="calcular()">
            </div>

            <div class="card">
                <h3>2. Impostos e Marketing</h3>
                <div class="input-row">
                    <div><label>Imp. Importação (%)</label><input type="number" id="impImp" oninput="calcular()"></div>
                    <div><label>ICMS / IOF (%)</label><input type="number" id="icms" oninput="calcular()"></div>
                </div>
                <div class="input-row">
                    <div><label>Marketing (CPA Ideal %)</label><input type="number" id="mktPerc" value="25" oninput="calcular()"></div>
                    <div><label>Imposto Venda / NF (%)</label><input type="number" id="impVenda" oninput="calcular()"></div>
                </div>
            </div>

            <div class="card">
                <h3>3. Taxas de Transação</h3>
                <div class="input-row">
                    <div><label>Checkout (%)</label><input type="number" id="taxaCheckout" oninput="calcular()"></div>
                    <div><label>Gateway (%)</label><input type="number" id="taxaGateway" oninput="calcular()"></div>
                </div>
                <label>Taxa Fixa por Pedido</label>
                <input type="number" id="taxaFixa" oninput="calcular()">
            </div>
        </div>

        <div>
            <div class="result-box">
                <label style="color: var(--orange);">LUCRO LÍQUIDO POR VENDA</label>
                <div id="resLucro" class="big-price">0,00</div>
                <div id="resMargem" style="font-weight: 700;">0% de margem</div>
            </div>

            <div class="card" style="margin-top: 20px;">
                <h3>Métricas de Equilíbrio</h3>
                <div class="detail-item"><span>Markup:</span> <span id="detMarkup" style="font-weight:bold;">0x</span></div>
                <div class="detail-item"><span>CPA Ideal (25%):</span> <span id="detCpaIdeal" style="color:var(--blue);">0</span></div>
                <div class="detail-item" style="border:0"><span>CPA Break-even (Ponto Zero):</span> <span id="detBreakEven" style="color:var(--orange); font-weight:bold;">0</span></div>
            </div>

            <div class="card">
                <h3>Composição do Preço</h3>
                <div class="comp-bar">
                    <div id="barCusto" class="comp-item" style="background: #555;"></div>
                    <div id="barMkt" class="comp-item" style="background: var(--orange);"></div>
                    <div id="barTaxas" class="comp-item" style="background: var(--blue);"></div>
                    <div id="barLucro" class="comp-item" style="background: var(--green);"></div>
                </div>
                <div class="detail-item"><span>(-) Produto + Frete + Imp. Import:</span> <span id="detTotalBase">0</span></div>
                <div class="detail-item"><span>(-) Marketing (CPA):</span> <span id="detMktReal">0</span></div>
                <div class="detail-item"><span>(-) Taxas + Impostos Venda:</span> <span id="detTaxasImp">0</span></div>
            </div>
        </div>
    </div>

    <h3>Projeção de Escala Mensal</h3>
    <div class="projection-grid" id="gridProj"></div>
</div>

<script>
    function calcular() {
        const s = document.getElementById('moeda').value;
        const v = (id) => {
            const val = parseFloat(document.getElementById(id).value);
            return isNaN(val) ? 0 : val; // Resolve o erro NaN interpretando como 0
        };

        // Entradas
        const custoProd = v('custoProd'), frete = v('frete'), precoVenda = v('precoVenda');
        const impImp = v('impImp'), icms = v('icms'), mktPerc = v('mktPerc'), impVenda = v('impVenda');
        const taxaCheck = v('taxaCheckout'), taxaGate = v('taxaGateway'), taxaFixa = v('taxaFixa');

        // Cálculo Base de Importação
        const custoLogistica = custoProd + frete;
        const vlrImpOri = custoLogistica * ((impImp + icms) / 100);
        const custoTotalOrigem = custoLogistica + vlrImpOri;

        // Custos Variáveis de Venda (Taxas + Imposto sobre Nota)
        const vlrTaxas = (precoVenda * ((taxaCheck + taxaGate) / 100)) + taxaFixa;
        const vlrImpVenda = precoVenda * (impVenda / 100);
        const totalTaxasEImpostos = vlrTaxas + vlrImpVenda;

        // Marketing
        const vlrMkt = precoVenda * (mktPerc / 100);

        // Lucro e Métricas
        const lucro = precoVenda - custoTotalOrigem - vlrMkt - totalTaxasEImpostos;
        const margem = precoVenda > 0 ? (lucro / precoVenda) * 100 : 0;
        const markup = custoTotalOrigem > 0 ? precoVenda / custoTotalOrigem : 0;
        
        // Break-even CPA: Preço de Venda - Custos Fixos - Taxas/Impostos
        const breakEvenCpa = precoVenda - custoTotalOrigem - totalTaxasEImpostos;

        // UI Update
        const resL = document.getElementById('resLucro');
        resL.innerText = `${s} ${lucro.toFixed(2)}`;
        resL.style.color = lucro >= 0 ? 'var(--green)' : 'var(--red)';
        
        document.getElementById('resMargem').innerText = `${margem.toFixed(1)}% de margem`;
        document.getElementById('resMargem').style.color = margem >= 0 ? 'var(--green)' : 'var(--red)';

        document.getElementById('detMarkup').innerText = `${markup.toFixed(2)}x`;
        document.getElementById('detCpaIdeal').innerText = `${s} ${vlrMkt.toFixed(2)}`;
        document.getElementById('detBreakEven').innerText = `${s} ${breakEvenCpa.toFixed(2)}`;

        document.getElementById('detTotalBase').innerText = `${s} ${custoTotalOrigem.toFixed(2)}`;
        document.getElementById('detMktReal').innerText = `${s} ${vlrMkt.toFixed(2)}`;
        document.getElementById('detTaxasImp').innerText = `${s} ${totalTaxasEImpostos.toFixed(2)}`;

        // Barra de Composição (Visual)
        if(precoVenda > 0) {
            document.getElementById('barCusto').style.width = (custoTotalOrigem / precoVenda * 100) + "%";
            document.getElementById('barMkt').style.width = (vlrMkt / precoVenda * 100) + "%";
            document.getElementById('barTaxas').style.width = (totalTaxasEImpostos / precoVenda * 100) + "%";
            document.getElementById('barLucro').style.width = (lucro > 0 ? (lucro / precoVenda * 100) : 0) + "%";
        }

        // Projeção
        const escalas = [10, 50, 100, 500, 1000, 5000];
        document.getElementById('gridProj').innerHTML = escalas.map(q => `
            <div class="proj-card">
                <small>${q} Vendas</small>
                <div style="color:${lucro >= 0 ? 'var(--green)' : 'var(--red)'}; font-weight:bold;">${s} ${(lucro * q).toLocaleString('pt-BR', {minimumFractionDigits: 2})}</div>
            </div>
        `).join('');
    }

    calcular();
</script>
</body>
</html>
